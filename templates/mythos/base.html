<!DOCTYPE html>

<html>
    <head>
        <title>{% block title %} Base Title {% endblock title %}</title>
        <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">

        <!-- Bootstrap -->
        <link href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
        <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
        <script src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

        <!-- VideoJS -->
        <link href="http://vjs.zencdn.net/4.5/video-js.css" rel="stylesheet">
        <script src="http://vjs.zencdn.net/4.5/video.js"></script>

        <!-- Autocomplete (jQuery UI, a separate library that is NOT jQuery-we need both) -->
        <link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.21/themes/base/jquery-ui.css" />
        <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.8.22/jquery-ui.min.js"></script>
        
        <!-- Mythos -->
        {% load staticfiles %}
        <link href= "{% static 'mythos.css' %}" rel="stylesheet">
        <script type="text/javascript">
            // In a perfect world, this would be its own library file that got included
            // on the page and only the ``$(document).ready(...)`` below would be present.
            // But this is an example.
            var Autocomplete = function(options) {
              this.form_selector = options.form_selector
              this.url = options.url || '/search/autocomplete/'
              this.delay = parseInt(options.delay || 300)
              this.minimum_length = parseInt(options.minimum_length || 3)
              this.form_elem = null
              this.query_box = null
            }

            Autocomplete.prototype.setup = function() {
              var self = this

              this.form_elem = $(this.form_selector)
              this.query_box = this.form_elem.find('input[name=q]')

              // Watch the input box.
              this.query_box.on('keyup', function() {
                var query = self.query_box.val()

                if(query.length < self.minimum_length) {
                  return false
                }

                self.fetch(query)
              })

            }

            Autocomplete.prototype.fetch = function(query) {
              var self = this

              $.ajax({
                url: '/search/autocomplete/'
              , data: {
                  'q': query
                }
              , success: function(data) {
                    console.log(data.results);
                    
                    $("#id_q").autocomplete({
                      source: data.results,
                      select: function(event, ui) { doRedirect(ui.item.label, ui.item.value ); }
                    });
                }
              })
            }
            function doRedirect(term, value) {
                console.log(term + " : " + value)
            }
            
            $(document).ready(function() {
              window.autocomplete = new Autocomplete({
                form_selector: '.autocomplete-me'
              })
              window.autocomplete.setup()
            })
        </script>

    </head>
  
    <body style="background-color:#111">
      {% block body %}
       <nav class="navbar navbar-default" role="navigation">
        <div class="container-fluid">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Mythos</a>
          </div>

<!--           <form class="navbar-form navbar-right" role="search">
            <div class="form-group">
              <input type="text" class="form-control" placeholder="Search">
            </div>
            <button type="submit" class="btn btn-default">Submit</button>
          </form> -->
            <div class="autocomplete-me ui-widget navbar-form navbar-right">
                <label for="id_q">Search: </label>
                <input type="text" id="id_q" name="q">
            </div>

          <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav navbar-right" style="padding-right:5%">
              <li><a href="/cultures">CULTURES</a></li>
              <li><a href="/stories">STORIES</a></li>
              <li><a href="/figures">FIGURES</a></li>
            </ul>
          </div>
        </div>
      </nav>
      {% endblock body %} 
    </body>
    
</html>